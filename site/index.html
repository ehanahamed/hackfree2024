<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=10, user-scalable=1"
    />
    <title>Imagera</title>
    <link rel="stylesheet" href="./css/layout.css" />
    <link rel="stylesheet" href="./css/colors.css" />
    <link rel="stylesheet" href="./css/components.css" />
    <link rel="stylesheet" href="./css/utils.css" />
    <link rel="stylesheet" href="https://www.nerdfonts.com/assets/css/webfont.css" />
  </head>
  <body>
    <div class="layout">
      <div class="menu surface">
        <div class="dropdown">
          <button class="toggle">File</button>
          <div class="content">
            <button id="setupButton">Image Setup</button>
            <button>Save/Export</button>
            <button>Editor Homescreen</button>
            <button id="menuFileContentSettings">Editor Settings</button>
          </div>
        </div>
        <div class="dropdown">
          <button class="toggle">Edit</button>
          <div class="content">
            <button>Undo</button>
            <button>Redo</button>
            <button>Copy</button>
          </div>
        </div>
      </div>
      <div class="main">
        <div class="tools surface">
          <div class="flex varDir">
            <button id="toolSelect" class="select" onclick="tools.select()"><i class="nf nf-fa-mouse_pointer"></i></button>
            <button id="toolMove" class="select" onclick="tools.move()"><i class="nf nf-md-cursor_move"></i></button>
          </div>
        </div>
        <div class="view surface">
          <canvas  id="outerCanvas" width="400" height="300">
          </canvas>
        </div>
        <div class="current surface">current tool options</div>
        <div class="layers surface">
          <div class="flex col nowrap">
            <div id="layersList" class="flex col nowrap">
            </div>
            <button id="layersAddLayer">Add Layer</button>
          </div>
        </div>
      </div>
    </div>
    <div id="addLayerModal" class="modal hide autoSpace">
      <div class="content">
        <div class="grid duo">
          <div class="flex col alignCenter">
            <i class="nf large nf-md-file_image_plus_outline"></i>
            <label id="addLayerImageLabel" for="addLayerImageInput" class="button">Open/Add Image</label>
            <input type="file" id="addLayerImageInput" class="invisible" />
          </div>
          <div class="flex col alignCenter">
            <i class="nf large nf-md-layers_plus"></i>
            <button id="addLayerEmpty">Add Empty Layer</button>
          </div>
        </div>
        <br />
        <br />
        <div class="flex justifyCenter">
          <button id="addLayerModalAiButton">Generate an Image with AI</button>
        </div>
      </div>
    </div>
    <div id="addLayerAiModal" class="modal hide autoSpace">
      <div class="content">
        <p class="h3">Generate an Image</p>
        <textarea id="addLayerAiPrompt" placeholder="Prompt" value="400"></textarea>
      </div>
    </div>
    <div id="setupModal" class="modal hide autoSpace">
      <div class="content">
        <p class="h3">Image Setup</p>
        <div class="flex">
          <input type="text" id="setupWidth" placeholder="Width" value="400" />
          <input type="text" id="setupHeight" placeholder="Height" value="300" />
        </div>
        <button id="setupDone">Done</button>
      </div>
    </div>
    <div id="settings" class="modal hide autoSpace">
      <div class="content">
        <p class="h3">Editor Settings</p>
        <p class="h4">Appearance</p>
        <div class="box">
          <p>Theme</p>
          <div class="radio">
            <input type="radio" id="settingsThemedefault" name="settingsTheme" />
            <label for="settingsThemedefault">Default</label>
          </div>
          <div class="radio">
            <input type="radio" id="settingsThemepurpleish" name="settingsTheme" />
            <label for="settingsThemepurpleish">Purpleish</label>
          </div>
          <div class="radio">
            <input type="radio" id="settingsThemelight" name="settingsTheme" />
            <label for="settingsThemelight">Light</label>
          </div>
        </div>
        <p class="h4">AI</p>
        <div class="box">
          <p><a href="https://platform.stability.ai/" target="_blank" rel="noopener noreferrer">Stability AI</a> API key (Stable Diffusion)</p>
          <div class="flex">
            <input type="text" id="settingsStabilityaiKey" placeholder="API key" />
            <button id="settingsStabilityaiReset">Reset</button>
          </div>
          <p><a href="https://platform.openai.com" target="_blank" rel="noopener noreferrer">OpenAI</a> API key (DALL-E)</p>
          <div class="flex">
            <input type="text" id="settingsOpenaiKey" placeholder="API key" />
            <button id="settingsOpenaiReset">Reset</button>
          </div>
        </div>
        <button id="settingsClose">Done</button>
      </div>
    </div>
    <script src="./js/ui.js"></script>
    <script src="./js/canvas.js"></script>
    <script src="./js/layers.js"></script>
    <script src="./js/tools.js"></script>
    <script>
      document.getElementById("layersAddLayer").addEventListener(
        "click",
        function () {
          document.getElementById("addLayerModal").classList.remove("hide");
        }
      );
      document.getElementById("addLayerEmpty").addEventListener(
        "click",
        function () {
          layers.add();
          document.getElementById("addLayerModal").classList.add("hide");
        }
      );
      document.getElementById("addLayerModalAiButton").addEventListener(
        "click",
        function () {
          document.getElementById("addLayerModal").classList.add("hide");
          document.getElementById("addLayerAiModal").classList.remove("hide");
        }
      )
      document.getElementById("addLayerImageInput").addEventListener(
        "change",
        function (event) {
          var fileReader = new FileReader();
          fileReader.onload = function (event) {
            var image = new Image();
            image.onload = function() {
              newLayerIndex = layers.add(image.width, image.height);
              console.log(image.width);
              layers.layers[newLayerIndex].canvas.getContext("2d").drawImage(
                image,
                0,
                0
              );
              canvas.draw();
              ui.layers.refresh();
              document.getElementById("addLayerModal").classList.add("hide");
            }
            image.src = event.target.result;
          }
          fileReader.readAsDataURL(event.target.files[0]);
        },
        false
      )
    </script>
    <script>
      document.getElementById("setupButton").addEventListener(
        "click",
        function () {
          document.getElementById("setupModal").classList.remove("hide");
        }
      );
      document.getElementById("setupDone").addEventListener(
        "click",
        function () {
          canvas.resize(
            parseInt(document.getElementById("setupWidth").value),
            parseInt(document.getElementById("setupHeight").value)
          )
          document.getElementById("setupModal").classList.add("hide");
        }
      )
    </script>
    <script>
      document.getElementById("menuFileContentSettings").addEventListener(
        "click",
        function () {
          document.getElementById("settings").classList.remove("hide");
        }
      )
      document.getElementById("settingsClose").addEventListener(
        "click",
        function () {
          document.getElementById("settings").classList.add("hide");
        }
      )
      
      document.getElementById("settingsThemedefault").addEventListener(
        "change",
        function () {
          ui.setTheme("default");
        }
      );
      document.getElementById("settingsThemepurpleish").addEventListener(
        "change",
        function () {
          ui.setTheme("purpleish");
        }
      );
      document.getElementById("settingsThemelight").addEventListener(
        "change",
        function () {
          ui.setTheme("light");
        }
      );

      document.getElementById("settingsTheme" + ui.getTheme()).checked = true;
    </script>
  </body>
</html>
